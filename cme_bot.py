from playwright.sync_api import sync_playwright import requests import time from datetime import datetime, timedelta # üåü URL ‡∏Ç‡∏≠‡∏á Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì FIREBASE_URL_TEMPLATE = "https://cme-quant-bot-default-rtdb.asia-southeast1.firebasedatabase.app/daily_data/{date}/{contract}/{time}_{type}.json" # ========================================================= # ‚è∞ Expiration Time Utilities (Thai Time / CME CT) # CME Gold Options ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ó‡∏£‡∏î 12:30 PM CT # CT (Winter/CST, UTC-6): 12:30 PM ‚Üí 01:30 AM Thai (‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ) # CDT (Summer/CDT, UTC-5): 12:30 PM ‚Üí 00:30 AM Thai (‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ) # ========================================================= def is_us_dst(dt): """‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á US Daylight Saving Time ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà DST: 2nd Sunday of March ‚Üí 1st Sunday of November""" year = dt.year # ‡∏´‡∏≤ 2nd Sunday of March mar1 = datetime(year, 3, 1) days_to_sun = (6 - mar1.weekday()) % 7 dst_start = mar1 + timedelta(days=days_to_sun + 7) # 2nd Sunday # ‡∏´‡∏≤ 1st Sunday of November nov1 = datetime(year, 11, 1) days_to_sun = (6 - nov1.weekday()) % 7 dst_end = nov1 + timedelta(days=days_to_sun) # 1st Sunday return dst_start <= dt.replace(hour=0, minute=0, second=0, microsecond=0) < dst_end def get_expiration_datetime_thai(exp_date): """‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô Thai local time - exp_date: datetime ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏à‡∏≤‡∏Å CME dropdown) - return: datetime ‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (Thai time) ‡∏ó‡∏µ‡πà series ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ CME Gold Options close: 12:30 PM CT Winter (CST, UTC-6): +13h30m ‚Üí 01:30 AM Thai time (day after exp_date) Summer (CDT, UTC-5): +12h30m ‚Üí 00:30 AM Thai time (day after exp_date) """ if is_us_dst(exp_date): # CDT: 12:30 PM + 12h30m = 00:30 AM next day Thai return exp_date + timedelta(hours=24, minutes=30) # = exp_date+1 day, 00:30 else: # CST: 12:30 PM + 13h30m = 01:30 AM next day Thai return exp_date + timedelta(days=1, hours=1, minutes=30) # = exp_date+1 day, 01:30 def is_series_active(exp_date, now=None): """‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ series ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Thai time)""" if now is None: now = datetime.now() expiration_cutoff = get_expiration_datetime_thai(exp_date) return now < expiration_cutoff def get_highcharts_data(page): """‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏≠‡∏ö‡∏•‡πâ‡∏ß‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏≤‡∏ü""" return page.evaluate("""() => { if (window.Highcharts && window.Highcharts.charts) { let chart = window.Highcharts.charts.find(c => c !== undefined); if (chart && chart.options) { let rawTitle = chart.title ? chart.title.textStr : "Unknown Contract"; let cleanTitle = rawTitle.replace(/<[^>]*>?/gm, '').replace(/&nbsp;/g, ' ').trim(); let pureContract = cleanTitle.split(' ')[0]; let settings = chart.userOptions.custom ? chart.userOptions.custom.Settings : {}; let extractedPoints = []; chart.series.forEach(series => { if(series.data && series.data.length > 0) { let sName = series.name || "Unknown"; let sId = series.options.id || ""; let yTitle = (series.yAxis && series.yAxis.axisTitle && series.yAxis.axisTitle.textStr) ? series.yAxis.axisTitle.textStr : ""; let dataType = "-"; let checkStr = (sName + " " + sId + " " + yTitle).toLowerCase(); if (checkStr.includes("oi") || checkStr.includes("open interest")) dataType = "OI"; else if (sName.includes("Settle") || checkStr.includes("volatility")) dataType = "Volatility"; else if (checkStr.includes("vol") || checkStr.includes("intraday")) dataType = "Intraday"; else if (sName === "Ranges") dataType = "Probability Band"; series.data.forEach(point => { if(point.x !== undefined && point.y !== undefined) { extractedPoints.push({ Contract: pureContract, SeriesName: sName, DataType: dataType, Strike: point.x, Value: point.y }); } }); } }); return { contract: pureContract, full_title: cleanTitle, price: settings.FuturePrice, dte: settings.DTE, vol_settle: settings.ATMVol, points: extractedPoints }; } } return null; }""") def push_to_firebase(data, data_type): """‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô Cloud ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥""" now = datetime.now() date_str = now.strftime("%Y-%m-%d") time_str = now.strftime("%H-%M-%S") url = FIREBASE_URL_TEMPLATE.format(date=date_str, contract=data['contract'], time=time_str, type=data_type) try: response = requests.put(url, json=data) if response.status_code == 200: print(f"‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î {data['contract']} [{data_type}] ‡∏Ç‡∏∂‡πâ‡∏ô Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ({time_str})") else: print(f"‚ùå Error Uploading: {response.text}") except Exception as e: print(f"‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ: {e}") # ========================================================= # üì¶ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°: ‡πÄ‡∏´‡∏°‡∏≤‡∏à‡∏ö ‡∏î‡∏∂‡∏á Intraday + OI # ========================================================= def process_current_series(page, series_type_name): print(f"
--- üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏π‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î: {series_type_name} ---") # 1. ‡∏£‡∏≠ Intraday print(f"üì• [{series_type_name}] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Intraday... (‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏à‡∏≠)") intraday_data = None attempt = 1 while True: intraday_data = get_highcharts_data(page) if intraday_data: print(f"‚úÖ [{series_type_name}] ‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Intraday ‡πÅ‡∏•‡πâ‡∏ß! (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt})") push_to_firebase(intraday_data, "Intraday") break else: print(f"‚è≥ [{series_type_name}] ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ Intraday... ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt})") time.sleep(3) attempt += 1 # 2. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° OI print(f"üñ±Ô∏è [{series_type_name}] Intraday ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß -> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏î‡πÑ‡∏õ‡∏´‡∏≤ 'Open Interest'...") while True: try: target_button = None try: potential_btn = page.locator("a[id$='lbOI']").first if potential_btn.is_visible(): print(f"üéØ ‡πÄ‡∏à‡∏≠‡πÇ‡∏î‡∏¢ ID (lbOI): {potential_btn.get_attribute('id')}") target_button = potential_btn except: pass if not target_button: print("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ID lbOI... ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å Text") vtabs = page.locator("li.vtab").all() for vtab in vtabs: classes = vtab.get_attribute("class") or "" txt = vtab.inner_text().strip() if "spacer" in classes: continue if txt == "OI" or "Open Interest" in txt: print(f" ‚úÖ ‡πÄ‡∏à‡∏≠ Tab ‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à: {txt} (Class: {classes})") link = vtab.locator("a").first if link.count() > 0: target_button = link else: target_button = vtab break if target_button: print(f"üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ: {target_button.inner_text()} (Tag: {target_button.evaluate('el => el.tagName')})") target_button.click(force=True) print("üëá ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...") time.sleep(5) else: print("‚ùå ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Clickable 'Open Interest' ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠") current_data = get_highcharts_data(page) break except Exception as e: print(f"‚ùå Error while clicking OI: {e} ... ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ") time.sleep(3) # 3. ‡∏£‡∏≠ OI print(f"üì• [{series_type_name}] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OI...") oi_data = None attempt = 1 while True: raw_data = get_highcharts_data(page) if raw_data: is_oi = False if raw_data.get('points'): first_point = raw_data['points'][0] if first_point.get('DataType') == 'OI': is_oi = True if is_oi: print(f"‚úÖ [{series_type_name}] ‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OI ‡πÅ‡∏•‡πâ‡∏ß! (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt})") push_to_firebase(raw_data, "OI") oi_data = raw_data # ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ return break else: title = raw_data.get('full_title', 'No Title') first_point_type = raw_data['points'][0].get('DataType') if raw_data.get('points') else "No Points" print(f"‚è≥ [{series_type_name}] ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà OI (Type: {first_point_type}, Title: {title})... ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt})") if attempt % 5 == 0: print(f"‚ö†Ô∏è ‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt}) -> ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° 'Open Interest' ‡∏¢‡πâ‡∏≥‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ...") try: page.locator("text='Open Interest' >> visible=true").first.click(force=True) except: pass time.sleep(3) else: print(f"‚è≥ [{series_type_name}] ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Å‡∏£‡∏≤‡∏ü... ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {attempt})") time.sleep(3) attempt += 1 # ------------------------------------- # 3. üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà: ‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ EOD (Volatility Surface) # ------------------------------------- print(f"üñ±Ô∏è [{series_type_name}] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ó‡πá‡∏ö 'EOD' (Volatility)...") try: # ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ EOD ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å eod_btn = page.locator("text='EOD' >> visible=true") if eod_btn.count() > 0: eod_btn.first.click(force=True) print(f"‚è≥ [{series_type_name}] ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü EOD ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...") time.sleep(5) print(f"üì• [{series_type_name}] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• EOD Volatility...") eod_data = get_highcharts_data(page) # ‡πÇ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ Type ‡∏ß‡πà‡∏≤ 'EOD' if eod_data: push_to_firebase(eod_data, "EOD") else: print(f"‚ö†Ô∏è [{series_type_name}] ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• EOD (get_highcharts_data return None)") else: print(f"‚ùå [{series_type_name}] ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏° EOD ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠!") except Exception as e: print(f"‚ùå [{series_type_name}] ‡∏ö‡∏≠‡∏ó‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ EOD ‡∏û‡∏•‡∏≤‡∏î: {e}") # page.screenshot(path=f"error_screen_eod_{series_type_name}.png") print(f"--- ‚úÖ ‡∏à‡∏ö‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ä‡∏∏‡∏î: {series_type_name} (‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!) ---
") extracted_contract = "Unknown" if intraday_data: extracted_contract = intraday_data.get('contract', 'Unknown') elif oi_data: extracted_contract = oi_data.get('contract', 'Unknown') return extracted_contract # ========================================================= # üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏â‡∏•‡∏≤‡∏î: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Series ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î # (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏à‡∏£‡∏¥‡∏á ~‡∏ï‡∏µ 1:30 Thai / 00:30 ‡∏ä‡πà‡∏ß‡∏á DST) # ========================================================= def select_best_secondary_series(page, current_main_series_code="OGJ6"): print("
üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Series ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î...") options = page.locator(".link-selector ul.nav li a").all() candidates = [] now = datetime.now() dst_status = "CDT (Summer)" if is_us_dst(now) else "CST (Winter)" print(f"üìÖ ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: {now.strftime('%d %b %Y %H:%M:%S')} | US Timezone: {dst_status}") for opt in options: try: full_text = opt.inner_text().strip() lines = full_text.split('
') if len(lines) >= 2: code = lines[0].strip() date_str = lines[1].strip() try: exp_date = datetime.strptime(date_str, "%d %b %Y") expiry_thai = get_expiration_datetime_thai(exp_date) active = is_series_active(exp_date, now) status_icon = "üü¢" if active else "üî¥" print(f" {status_icon} {code} | Exp: {date_str} | Cutoff Thai: {expiry_thai.strftime('%d %b %H:%M')} | {'ACTIVE' if active else 'EXPIRED'}") # ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ series ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å if active and code != current_main_series_code: candidates.append({ 'code': code, 'date': exp_date, 'expiry_thai': expiry_thai, 'element': opt }) except ValueError: continue except: continue if candidates: # Sort by date ascending (‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô) candidates.sort(key=lambda x: x['date']) best_choice = candidates[0] print(f"üéØ ‡πÄ‡∏à‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢! Series ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠: {best_choice['code']} (Exp: {best_choice['date'].strftime('%d %b %Y')}, Cutoff: {best_choice['expiry_thai'].strftime('%d %b %H:%M')})") best_choice['element'].click(force=True) return best_choice['code'] else: print("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ Series ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÄ‡∏•‡∏¢ (‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å)") return None def run_bot(): print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Bot ‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô...") with sync_playwright() as p: browser = p.chromium.launch(headless=True) context = browser.new_context(viewport={'width': 1280, 'height': 800}) page = context.new_page() print("üåê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö CME...") page.goto("https://cmegroup-tools.quikstrike.net//User/QuikStrikeView.aspx?pid=40&pf=6&viewitemid=IntegratedV2VExpectedRange&insid=209341331&qsid=baf9e29e-d0c4-4680-bac6-5b07eabe76b5") page.wait_for_load_state("domcontentloaded") print("‚è≥ ‡∏£‡∏≠‡πÉ‡∏´‡πâ UI ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...") time.sleep(8) # üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 1: ‡∏î‡∏∂‡∏á‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏´‡∏•‡∏±‡∏Å main_contract = process_current_series(page, "Main_Monthly") print(f"üìå Main Contract detected: {main_contract}") # üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ö‡∏ö Dynamic print("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤ '‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏£‡∏≠‡∏á' (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Dropdown)...") try: page.locator("text='Expiration:' >> visible=true").first.click(force=True) time.sleep(2) selected_code = select_best_secondary_series(page, current_main_series_code=main_contract) if selected_code: print("‚è≥ ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏£‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...") time.sleep(8) # ‡∏Å‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Intraday ‡∏Å‡πà‡∏≠‡∏ô try: intraday_btn = page.locator("text='Intraday Volume' >> visible=true") if intraday_btn.count() > 0: intraday_btn.first.click(force=True) time.sleep(5) except: pass process_current_series(page, f"Secondary_{selected_code}") else: print("‚ùå ‡∏Ç‡πâ‡∏≤‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Series ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ") except Exception as e: print(f"‚ùå ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {e}") page.screenshot(path="error_change_series.png") print("üéâ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå!") browser.close() if __name__ == "__main__": run_bot()